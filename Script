DROP DATABASE TIENDA2021v2;
CREATE DATABASE TIENDA2021v2;
USE TIENDA2021v2;

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

CREATE TABLE `Rol` (
  `id` int  NOT NULL AUTO_INCREMENT ,
  `rol_nombre` varchar(45)NOT NULL,
  `fecha_reg` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `estado` int default 1,
   PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;




CREATE TABLE `usuario_rol` (
  `id` int  NOT NULL  AUTO_INCREMENT ,
  `usuario_id`  int(06) NOT NULL,
  `rol_id` int NOT NULL,
  `fechaInicio`  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `usuario` (
  `idUsuario` int(06) NOT NULL  AUTO_INCREMENT,
  `nombreUsuario` varchar(100) not null ,
  `password` varchar(100) not null ,
  `paterno` varchar(89) ,
  `materno` varchar(89) ,
  `nombre` varchar(45) ,
  `dni` varchar(8),
  `direccion` varchar(255),
  `celular`  char(9),
  `email` varchar(100),
   `ruc` varchar(11),
  `razon_social` varchar(255),
`  Fecha_registro` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`idUsuario`)
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `compras` (
  `idCompras` int(11) AUTO_INCREMENT NOT NULL,
  `FechaCompras` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `Monto` double DEFAULT NULL,
  `NombreProducto` varchar(300)DEFAULT NULL,
  `Estado` int DEFAULT NULL,
  `direccion` varchar(50) DEFAULT NULL,
  `pais` varchar(50) DEFAULT NULL,
  `distrito` varchar(50) DEFAULT NULL,
  `provincia` varchar(50) DEFAULT NULL,
  `codigoPostal` int DEFAULT NULL,
  `nota` varchar(50) DEFAULT NULL,
  `idUsuario` int(11)  NOT NULL,
   PRIMARY KEY (`idCompras`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `detalle_compras` (
  `idDetalle` int(10) AUTO_INCREMENT NOT NULL,
  `FechaRegistro`  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `idProducto` int(11)  NOT NULL,
  `idCompras` int(11)  NOT NULL,
  PRIMARY KEY (`idDetalle`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `pedido_detalle` (
  `idPedido` int(10) AUTO_INCREMENT NOT NULL,
  `idDetalle`  int(10) NOT NULL,
  `idUsuario` int(11)  NOT NULL,
  `fechaPedido` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ,
  PRIMARY KEY (`idPedido`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `producto` (
  `idProducto` int NOT NULL AUTO_INCREMENT,
  `nombre` varchar(45) ,
  `marca` varchar(100) ,
  `precio` decimal (10,4),
  `direccion` Varchar(255),
  `descripcion` varchar(255) ,
  `condicion` varchar(255) ,
  `id_categoria` int not null,
  `idFavortio_favorito` int ,
  `img1` varchar(250) ,
   `idUsuario`  int,
  `Fecha_registro` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`idProducto`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `pago` (
  `idPago` int(11) NOT NULL AUTO_INCREMENT,
  `Monto` double DEFAULT NULL,
  PRIMARY KEY (`idPago`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `Categoria` (
  `id_categoria` int NOT NULL AUTO_INCREMENT,
  `nombre` varchar(255) NOT NULL,
 PRIMARY KEY (`id_categoria`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `Facturacion` (
  `id_facturacion` int NOT NULL,
  `descripcion` varchar(255) ,
  `unidad_pre` decimal(7,3)  ,
  `importe` decimal(7,3),
  `fecha_facturacion` datetime ,
  `idCompra` int(6) ,
  `id_usuario_usuario` int(6) 
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `Favoritos` (
  `id_Favorito` int  not null,
  `idUsuario_usuario` int(06) NOT NULL,
  `idproducto_producto` int NOT NULL,
   PRIMARY KEY (`id_Favorito`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `Imagen` (
  `id_imagen` int  not null,
  `contenido` longblob NOT NULL,
  `idproducto_producto` int NOT NULL,
   PRIMARY KEY (`id_imagen`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `usuario` AUTO_INCREMENT=1 ;
ALTER TABLE `producto` AUTO_INCREMENT = 1;
ALTER TABLE `Facturacion`
 ADD PRIMARY KEY (`id_facturacion`);
ALTER TABLE `imagen` AUTO_INCREMENT = 1;
ALTER TABLE `Favoritos` AUTO_INCREMENT = 1;
ALTER TABLE `Categoria` AUTO_INCREMENT = 1;
ALTER TABLE `usuario_rol` AUTO_INCREMENT = 1;
ALTER TABLE `usuario_rol`
 ADD CONSTRAINT `usuario_roles_fk` FOREIGN KEY (`rol_id`) REFERENCES `Rol` (`id`);
ALTER TABLE `usuario_rol`
  ADD CONSTRAINT `usuario_roles_fk3` FOREIGN KEY (`usuario_id`) REFERENCES `usuario` (`idUsuario`);
ALTER TABLE `producto`
  ADD CONSTRAINT `producto_fk` FOREIGN KEY (`id_categoria`) REFERENCES `Categoria` (`id_categoria`); 
ALTER TABLE `producto`
  ADD CONSTRAINT `producto_fk2` FOREIGN KEY (`idFavortio_favorito`) REFERENCES `Favoritos` (`id_Favorito`);  
ALTER TABLE `producto`
  ADD CONSTRAINT `producto_fk3` FOREIGN KEY (`idUsuario`) REFERENCES `usuario` (`idUsuario`);  

 ALTER TABLE `Facturacion`
  ADD CONSTRAINT `Facturacion_fk` FOREIGN KEY (`id_usuario_usuario`) REFERENCES `usuario` (`idUsuario`); 

 ALTER TABLE `Facturacion`
  ADD CONSTRAINT `Facturacion_fk2` FOREIGN KEY (`idCompra`) REFERENCES `Compras` (`idCompras`);  

ALTER TABLE `Favoritos`
  ADD CONSTRAINT `Favoritos_fk1` FOREIGN KEY (`idUsuario_usuario`) REFERENCES `usuario` (`idUsuario`);
ALTER TABLE `Favoritos`
  ADD CONSTRAINT `Favoritos_fk2` FOREIGN KEY (`idproducto_producto`) REFERENCES `Producto` (`idProducto`);
ALTER TABLE `Imagen`
  ADD CONSTRAINT `Imagen_fk1` FOREIGN KEY (`idproducto_producto`) REFERENCES `Producto` (`idProducto`);
ALTER TABLE `compras`
  ADD CONSTRAINT `venta_fk` FOREIGN KEY (`idUsuario`) REFERENCES `Usuario` (`idUsuario`);


ALTER TABLE `detalle_compras`
  ADD CONSTRAINT `venta_producto_fk` FOREIGN KEY (`idProducto`) REFERENCES `Producto` (`idProducto`);  

ALTER TABLE `detalle_compras`
  ADD CONSTRAINT `venta_producto_fk2` FOREIGN KEY (`idCompras`) REFERENCES `Compras` (`idCompras`);  

ALTER TABLE `pedido_detalle`
  ADD CONSTRAINT `venta_producto_fk3` FOREIGN KEY (`idDetalle`) REFERENCES `Compras` (`idCompras`);  

ALTER TABLE `pedido_detalle`
  ADD CONSTRAINT `venta_producto_fk4` FOREIGN KEY (`idUsuario`) REFERENCES `usuario` (`idUsuario`);  
  

insert into Rol values(null,"ROLE_ADMIN",null,default);
insert into Rol values(null,"ROLE_USER",null,default);
insert into Categoria (nombre) values ("Tecnologia");
insert into Categoria  (nombre) values ("ElectroDomesticos");
insert into Categoria  (nombre) values ("Hogar y Muebles");
insert into Categoria  (nombre) values ("Deportes");
insert into Categoria (nombre)  values ("Belleza y Cuidado Personal");
insert into Categoria  (nombre) values ("Herramientas");
insert into Categoria (nombre) values ("Contruccion");
insert into Categoria (nombre) values ("Industrias y Oficinas");
insert into Categoria (nombre) values ("Juegos y juguetes");
insert into Categoria (nombre) values ("Bebes");
insert into Categoria (nombre)  values ("Ropa y Acccesorios");
insert into Categoria (nombre)  values ("Salud y Equipamiento Medico");
insert into Categoria (nombre)  values ("Accesorios para vehiculos");
